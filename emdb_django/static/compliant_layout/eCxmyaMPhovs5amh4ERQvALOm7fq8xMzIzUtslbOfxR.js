(function(a){if(typeof define==="function"&&define.amd){define(["core/AbstractWidget"],a)}else{a()}}(function(){AjaxSolr.AbstractTextWidget=AjaxSolr.AbstractWidget.extend({constructor:function(a){AjaxSolr.AbstractTextWidget.__super__.constructor.apply(this,arguments);AjaxSolr.extend(this,{start:0},a)},set:function(a){return this.changeSelection(function(){this.manager.store.get("q").val(a)})},clear:function(){return this.changeSelection(function(){this.manager.store.remove("q")})},changeSelection:function(a){var b=this.manager.store.get("q").val();a.apply(this);var c=this.manager.store.get("q").val();if(c!==b){this.afterChangeSelection(c)}return c!==b},afterChangeSelection:function(a){},unclickHandler:function(){var a=this;return function(){if(a.clear()){a.doRequest()}return false}},clickHandler:function(b){var a=this;return function(){if(a.set(b)){a.doRequest()}return false}}})}));var categories={status:"Entry status",experimental_method:"Experimental method",molecule_type:"Molecule type",molecule_name:"Molecule",compound_name:"Compound name",gene_name:"Gene name",entry_authors:"Author name",all_authors:"Authors",superkingdom:"Superkingdom",genus:"Genus",organism_synonym:"Organism synonym",organism_scientific_name:"Organism scientific name",ec_number:"EC number",biological_process:"Biological process",biological_function:"Biological function",biological_cell_component:"Cell component",assembly_composition:"Assembly composition",assembly_form:"Assembly form",interacting_molecules:"Interacting molecule",interacting_ligands:"Interacting small molecule",citation_year:"Citation year",journal:"Journal",citation_authors:"Citation author",interpro_name:"Interpro name",pfam_name:"Pfam domain",scop_class:"SCOP class",scop_family:"SCOP family",scop_fold:"SCOP fold",spacegroup:"Spacegroup",refinement_software:"Refinement software",beam_source_name:"Diffraction source",detector:"Diffraction detector",detector_type:"Detector type",diffraction_protocol:"Diffraction protocol",cath_class:"CATH class",cath_topology:"CATH topology",assembly_type:"Assembly type",ec_hierarchy_name:"Enzyme",pdb_id:"PDB code",beam_source_type:"Beam source type"};(function(a){AjaxSolr.AutocompleteWidget=AjaxSolr.AbstractTextWidget.extend({constructor:function(b){AjaxSolr.extend(this,{fields:[],flFields:[],sortFields:[],limit:10,minLength:3},b)},init:function(){var b=this;if(!this.fields){throw'"field" must be set on AutocompleteWidget.'}this.servlet=this.manager.solrUrl||this.manager.servlet;a(this.target).find("input").catcomplete({minLength:b.minLength,position:{my:"right top",at:"right bottom"},open:function(c,d){},select:function(c,d){if(d.item){var e=d.item.field;b.requestSent=true;if(b.manager.store.addByValue("fq",e+":"+AjaxSolr.Parameter.escapeValue(d.item.value))){EntryManager.store.addByValue("fq",e+":"+AjaxSolr.Parameter.escapeValue(d.item.value));EntryManager.doRequest()}}a("#input").catcomplete("close")},source:function(g,e){var d=[];if(b.manager.name=="autocompleteMan"){d=["rows=20000&json.nl=map&group=true&group.field=category&group.limit=15"]}else{for(var c in b.manager.pdbe_param_defaults){if(a.type(b.manager.pdbe_param_defaults[c])===a.type([])){for(var h in b.manager.pdbe_param_defaults[c]){d.push(c+"="+b.manager.pdbe_param_defaults[c][h])}}else{d.push(c+"="+b.manager.pdbe_param_defaults[c])}}}var l="";for(var h=0;h<b.flFields.length;h++){if(l===""){l=l+b.flFields[h]}else{l=l+","+b.flFields[h]}}if(l!=""){d.push("fl="+l)}var f="";for(var h=0;h<b.sortFields.length;h++){if(f===""){f=f+b.sortFields[h]}else{f=f+","+b.sortFields[h]}}if(f!=""){d.push("sort="+f)}if(b.manager.name=="refineMan"){var k=b.manager.store.get("fq");for(var h=0;h<k.length;h++){if(k[h].value!="undefined"&&k[h].value!=null){var j=k[h].value.match(/(\S+)\:{1}(.+)/);j[2]=j[2].solrEscapeTerm();d.push("fq="+j[1]+":"+j[2])}}}g.term=g.term.solrEscapeTerm();if(b.manager.name=="autocompleteMan"){d.push("q="+b.fields[0]+":"+g.term)}if(b.manager.name=="refineMan"){d.push("facet.prefix="+g.term)}if(b.manager.name=="autocompleteMan"){b.manager.executeRequest("select",d.join("&"),function(r){var m=[];for(var o=0;o<r.grouped.category.groups.length;o++){var p=r.grouped.category.groups[o].groupValue;for(var n=0;n<r.grouped.category.groups[o].doclist.docs.length;n++){var q=r.grouped.category.groups[o].doclist.docs[n].value;var s=r.grouped.category.groups[o].doclist.docs[n].var_name;var t=r.grouped.category.groups[o].doclist.docs[n].num_pdb_entries;m.push({label:"<span class='truncate-text data-tooltip' title='"+q.replace(/'/g,"&#39")+"'>"+q+"</span> <span class='item_count'>("+t+")</span>",value:q,category:p,var_name:s})}}e(a.map(m,function(i){return i}))})}if(b.manager.name=="refineMan"){b.manager.executeRequest("select",d.join("&"),function(o){var t=[];for(var p in o.facet_counts.facet_fields){var m=p;var i=categories[p];var n=o.facet_counts.facet_fields[p];for(var s in n){var r=s;var q=n[s];t.push({label:"<span class='truncate-text data-tooltip' title='"+r.replace(/'/g,"&#39")+"'>"+r+"</span> <span class='item_count'>("+q+")</span>",value:r,category:i,var_name:m})}}e(a.map(t,function(u){return u}))})}}})}})})(jQuery);if(String.prototype.solrEscapeTerm==undefined){String.prototype.solrEscapeTerm=function(){var a=this;a=a.replace(/[\\+\-\!\(\)\:\^\]\{\}\~\*\?]/g,"\\$&");if(a.match(/ /g)&&a.match(/"^.*"$/)===null){a='"'+a+'*"~10'}else{a=a+"*~10"}return a}}(function(a){a(function(){AutoCompleteManager=new AjaxSolr.Manager({solrUrl:"http://wwwdev.ebi.ac.uk/pdbe/search/pdb-autocomplete/",name:"autocompleteMan"});AutoCompleteManager.addWidget(new AjaxSolr.AutocompleteWidget({id:"text",target:"#search",fields:["value"],flFields:["value","num_pdb_entries","var_name"],sortFields:["num_pdb_entries+desc"]}));AutoCompleteManager.init();AutoCompleteManager.store.addByValue("q","*:*");var b,c={group:true,"group.field":["pdb_id"],"group.ngroups":true,"group.facet":true,facet:true,"facet.field":["experimental_method","entry_authors","pfam_name","superkingdom","genus","organism_scientific_name","citation_year","spacegroup","biological_process","biological_function","biological_cell_component","journal","assembly_composition","assembly_form","assembly_type","refinement_software","detector","detector_type","diffraction_protocol","molecule_name","status","ec_number","cath_class","cath_topology","gene_name","compound_name","interpro_name","scop_class","scop_family","scop_fold","citation_authors","interacting_molecules","interacting_ligands","molecule_type","beam_source_name","beam_source_type"],"facet.limit":100,"facet.mincount":1,"facet.sort":"count","facet.range":["deposition_year","release_year","resolution"],"f.deposition_year.facet.range.start":"1970","f.deposition_year.facet.range.end":"2050","f.deposition_year.facet.range.gap":"5","f.release_year.facet.range.start":"1970","f.release_year.facet.range.end":"2050","f.release_year.facet.range.gap":"5","f.resolution.facet.range.start":"0.0","f.resolution.facet.range.end":"100","f.resolution.facet.range.gap":"0.5","f.deposition_year.facet.range.other":"between","f.deposition_year.facet.range.include":"upper","f.release_year.facet.range.other":"between","f.release_year.facet.range.include":"upper","f.resolution.facet.range.other":"between","f.resolution.facet.range.include":"upper","json.nl":"map"};for(b in c){AutoCompleteManager.store.addByValue(b,c[b])}});a.fn.showIf=function(b){if(b){return this.show()}else{return this.hide()}}})(jQuery);jQuery.widget("custom.catcomplete",jQuery.ui.autocomplete,{numToShow:10,numInColumn:30,columnContentCounter:0,_resizeMenu:function(){this.menu.element.css({margin:"0 5%",padding:"0"});this.menu.element.addClass("container_pdbe pdbe_search_autocomplete")},_renderMenu:function(f,g){var e=this,i="";var d=[];var a=0;var c="";var h=0;var b=g.length;f.append("<li name='test'><div class='search_top'>");jQuery.each(g,function(j,k){if(k.category!=i){if(e.columnContentCounter>=e.numToShow||h>1){f.find("div[data-type*='category'][data-category*='"+i+"']").append("<div data-type='more' class='more_controller grid_24 ui-state-disabled' data-category='"+i+"'>More...</div>")}e.columnContentCounter=0;h=0;f.find(".search_top").append("<div data-type='category' data-category='"+k.category+"' class='grid_6 reset_100'><div id='"+k.category+"'><h3 style='margin-bottom: 0;'> "+k.category+"</h3></div></div>");i=k.category}if(e.columnContentCounter===0){h++;f.find("div[data-type*='category'][data-category*='"+k.category+"']").append("<div data-type='column' data-category='"+k.category+"' data-column='"+h+"' class='grid_24'></div>");e._renderItemData(f.find("div[data-category*='"+k.category+"'][data-column*='"+h+"']"),k);e.columnContentCounter++}else{if(e.columnContentCounter<e.numInColumn&&e.columnContentCounter!=0){e._renderItemData(f.find("div[data-category*='"+k.category+"'][data-column*='"+h+"']"),k);e.columnContentCounter++}}if(e.columnContentCounter===e.numInColumn){h++;f.find("div[data-type*='category'][data-category*='"+k.category+"']").append("<div data-type='column' data-category='"+k.category+"' data-column='"+h+"' class='grid_24 data-hidden'></div>");e._renderItemData(f.find("div[data-category*='"+k.category+"'][data-column*='"+h+"']"),k);e.columnContentCounter=1}if(j===b){if(e.columnContentCounter>=e.numToShow||h>0){f.find("div[data-type*='category'][data-category*='"+i+"']").append("<div data-type='more' class='more_controller grid_24 ui-state-disabled' data-category='"+i+"'>More...</div>")}}});f.append("</div></li>");f.find("div[data-type='more']").unbind();f.off("click");f.find("a").on("click",function(j){j.preventDefault();jQuery(".data-tooltip").each(function(k,l){jQuery(l).tooltip("destroy")});if((window.location.href).indexOf("entry/search")<0){window.location.href="/pdbe/entry/search/index?"+jQuery(this).attr("data-varname")+":"+AjaxSolr.Parameter.escapeValue(jQuery(this).attr("value"));return false}jQuery("#local-searchbox").val(jQuery(this).attr("value"))});f.find('div[data-type*="more"]').on("click",function(){var j=jQuery(this).parent().attr("data-category");if(jQuery(this).text()==="More..."){jQuery(this).parent().removeClass("grid_6");jQuery(this).parent().addClass("grid_24");jQuery(this).parent().children().removeClass("data-hidden");jQuery(this).parent().parent().children().each(function(){if(jQuery(this).attr("data-category")!=j){jQuery(this).addClass("data-hidden")}});jQuery(this).text("Less...")}else{jQuery(this).parent().removeClass("grid_24");jQuery(this).parent().addClass("grid_6 reset_100");jQuery(this).parent().children().each(function(k){if(k===0){}else{if(k===1){}else{jQuery(this).addClass("data-hidden")}}});jQuery(this).parent().parent().children().each(function(){jQuery(this).removeClass("data-hidden")});jQuery(this).text("More...");jQuery(this).removeClass("data-hidden")}});jQuery(".data-tooltip").each(function(j,k){jQuery(k).tooltip({content:jQuery(k).attr("title"),track:true})})},_renderItem:function(c,b){var a=this;if(a.columnContentCounter<a.numToShow){return c.append("<div class='ui-menu-item ' role='menuitem'><a href='' value='"+b.value.replace(/'/g,"&#39")+"' data-category='"+b.category+"' data-varname='"+b.var_name+"'>"+b.label+"</a></div>")}else{return c.append("<div class='ui-menu-item data-hidden' role='menuitem'><a href='' value='"+b.value.replace(/'/g,"&#39")+"' data-category='"+b.category+"' data-varname='"+b.var_name+"'>"+b.label+"</a></div>")}},_renderItemData:function(a,c){var b=this;return b._renderItem(a,c).data("ui-autocomplete-item",c)}});jQuery("#local-searchbox").bind("enterKey",function(a){if(jQuery("#local-searchbox").val()!==""){jQuery(".data-tooltip").each(function(b,c){jQuery(c).tooltip("destroy")});if((window.location.href).indexOf("entry/search")<0){window.location.href="/pdbe/entry/search/index?text:"+jQuery("#local-searchbox").val();return false}jQuery("input").catcomplete();jQuery("input").catcomplete("close")}});jQuery(document).ready(function(){jQuery("#local-searchbox").keydown(function(a){if(a.keyCode===13){a.preventDefault();jQuery(this).trigger("enterKey");return false}})});